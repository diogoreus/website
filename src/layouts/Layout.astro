---
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
}

const { title, description = "Designer. Developer. Executive. AI Builder." } = Astro.props;
const POSTHOG_API_KEY = import.meta.env.PUBLIC_POSTHOG_API_KEY;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- PostHog Analytics -->
    {POSTHOG_API_KEY && (
      <script define:vars={{ POSTHOG_API_KEY }}>
        window.__POSTHOG_API_KEY__ = POSTHOG_API_KEY;
      </script>
    )}

    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />

    <title>{title}</title>
  </head>
  <body class="noise">
    <div id="global-overlay-root"></div>
    <slot />

    <script>
      import { initPostHog, trackEasterEggFound } from '../scripts/analytics';

      declare global {
        interface Window {
          __POSTHOG_API_KEY__?: string;
        }
      }

      // Initialize PostHog if API key is available
      const apiKey = window.__POSTHOG_API_KEY__;
      if (apiKey) {
        initPostHog(apiKey);
      }

      // Console messages for developers
      console.log('%cðŸ‘‹ Hey there, fellow developer!', 'font-size: 20px; font-weight: bold;');
      console.log('%cLooking for secrets? Try these:', 'font-size: 14px; color: #888;');
      console.log('%c  â€¢ Cmd+K anywhere (Command Palette)', 'font-size: 12px; color: #00ff00;');
      console.log('%c  â€¢ The terminal in Developer Era has some fun commands', 'font-size: 12px; color: #00ff00;');
      console.log('%c  â€¢ The Winamp player hides a few surprises', 'font-size: 12px; color: #00ff00;');
      console.log('%c\nðŸ’¼ Interested in working together?', 'font-size: 14px;');
      console.log('%c   https://linkedin.com/in/diogoreus', 'font-size: 12px; color: #0077b5;');

      // Konami Code easter egg
      const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];
      let konamiIndex = 0;
      let konamiTriggered = false;

      document.addEventListener('keydown', (e) => {
        if (konamiTriggered) return;

        const key = e.code;
        if (key === konamiCode[konamiIndex]) {
          konamiIndex++;
          if (konamiIndex === konamiCode.length) {
            konamiTriggered = true;
            showKonamiToast();
            trackEasterEggFound('konami_code');
          }
        } else {
          konamiIndex = key === konamiCode[0] ? 1 : 0;
        }
      });

      function showKonamiToast() {
        const toast = document.createElement('div');
        toast.innerHTML = `
          <div class="konami-toast">
            <span class="konami-icon">ðŸŽ®</span>
            <div class="konami-content">
              <div class="konami-title">Achievement Unlocked!</div>
              <div class="konami-subtitle">You found the Konami Code!</div>
            </div>
          </div>
        `;

        const style = document.createElement('style');
        style.textContent = `
          .konami-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 2px solid #00ff00;
            border-radius: 12px;
            box-shadow:
              0 0 20px rgba(0, 255, 0, 0.3),
              0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 99999;
            animation: konamiSlideIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1),
                       konamiSlideOut 0.3s ease-in 3.7s forwards;
            font-family: 'Press Start 2P', 'JetBrains Mono', monospace;
          }

          @keyframes konamiSlideIn {
            from {
              transform: translateX(120%);
              opacity: 0;
            }
            to {
              transform: translateX(0);
              opacity: 1;
            }
          }

          @keyframes konamiSlideOut {
            to {
              transform: translateX(120%);
              opacity: 0;
            }
          }

          .konami-icon {
            font-size: 32px;
            animation: konamiPulse 0.5s ease infinite alternate;
          }

          @keyframes konamiPulse {
            to {
              transform: scale(1.1);
            }
          }

          .konami-title {
            color: #00ff00;
            font-size: 12px;
            text-shadow: 0 0 10px #00ff00;
            margin-bottom: 4px;
          }

          .konami-subtitle {
            color: #888;
            font-size: 10px;
          }
        `;

        document.head.appendChild(style);
        document.body.appendChild(toast);

        setTimeout(() => {
          toast.remove();
          style.remove();
        }, 4200);
      }
    </script>
  </body>
</html>

<style is:global>
  /* Ensure smooth scrolling */
  html {
    scroll-behavior: smooth;
  }

  /* Loading state */
  body {
    opacity: 0;
    animation: fadeIn 0.5s ease forwards;
  }

  @keyframes fadeIn {
    to {
      opacity: 1;
    }
  }
</style>

---
/**
 * AI Era (2025+) - Experimental Particle-First Layout
 *
 * The particles ARE the layout. Content emerges from the noise.
 * Neural connections link content nodes. AI response typewriter simulation.
 * Canvas-first, content-second approach.
 */

import GlitchText from '../ai/GlitchText.astro';
import ParticleText from '../ai/ParticleText.astro';
import AIResponse from '../ai/AIResponse.astro';
import NodeNav from '../ai/NodeNav.astro';
import { Bot, BarChart3, Search, BookOpen, Database, Zap } from '@lucide/astro';

const navNodes = [
  { id: 'ai-intro', label: 'Genesis', icon: '◈' },
  { id: 'ai-project', label: 'Pipeline', icon: '⬡' },
  { id: 'ai-impact', label: 'Impact', icon: '◇' },
  { id: 'ai-company', label: 'Studio', icon: '◆' },
];

const aiResponseLines = [
  "Initialized GPT-5 curriculum generation pipeline...",
  "Processing 595 lessons across Grades 3-8 Language Arts.",
  "Generating 1M+ question candidates for validation.",
  "Applying 60+ automated quality checks per artifact.",
  "Final output: 66,413 validated questions. Quality: 91.9%",
];
---

<section id="era-ai" class="era-section ai-era">
  <!-- Full-screen Three.js particle canvas - THE MAIN EVENT -->
  <div id="particle-mount" class="particle-container"></div>

  <!-- Gradient mesh background fallback -->
  <div class="gradient-mesh"></div>

  <!-- Floating neural node navigation -->
  <div class="node-nav-wrapper">
    <NodeNav nodes={navNodes} />
  </div>

  <!-- Content emerges from the particle field -->
  <div class="ai-content">
    <!-- Era badge - floats in particle field -->
    <div class="floating-badge" id="ai-intro">
      <span class="badge-glyph">◈</span>
      <div class="badge-text">
        <span class="badge-year">2025 - ∞</span>
        <span class="badge-title">The AI Era</span>
      </div>
    </div>

    <!-- Main heading - text materializes from particles -->
    <div class="heading-wrapper">
      <ParticleText text="AI Builder" tag="h2" class="ai-heading" />
      <ParticleText text="by Evolution" tag="h2" class="ai-heading ai-heading--accent" delay={400} />
    </div>

    <!-- Intro with typing cursor -->
    <p class="ai-intro">
      From building learning platforms to building with AI at scale.
      Led one of the most ambitious AI curriculum projects in K-12 history.
      <span class="typing-cursor">|</span>
    </p>

    <!-- Project card - floats in particle space -->
    <div class="project-card" id="ai-project">
      <div class="card-border"></div>
      <div class="card-glow"></div>

      <div class="project-header">
        <div class="project-badge-group">
          <span class="project-badge">Flagship Project</span>
          <span class="project-status">
            <span class="status-dot"></span>
            Deployed
          </span>
        </div>
        <span class="project-company">AE Studio → Alpha School</span>
      </div>

      <h3 class="project-title">
        <GlitchText text="Alpha Incept" tag="span" />
      </h3>

      <p class="project-desc">
        A complete Grades 3-8 Language Arts curriculum generated using GPT-5 pipelines
        in 6 months, what traditionally takes years with large teams.
      </p>

      <!-- AI Response simulation -->
      <AIResponse lines={aiResponseLines} speed="fast" />
    </div>

    <!-- Impact Metrics - Compact -->
    <div class="metrics-bar" id="ai-impact">
      <div class="metric-item">
        <span class="metric-value">91.9%</span>
        <span class="metric-label">Quality Rating</span>
      </div>
      <div class="metric-item">
        <span class="metric-value">66K+</span>
        <span class="metric-label">Questions Generated</span>
      </div>
      <div class="metric-item">
        <span class="metric-value">595</span>
        <span class="metric-label">Lessons Created</span>
      </div>
      <div class="metric-item">
        <span class="metric-value">+17.8pp</span>
        <span class="metric-label">Test Improvement</span>
      </div>
    </div>

    <!-- AI/ML Skills -->
    <div class="skills-section animate-in">
      <h4 class="section-title">
        <span class="title-glyph">⬡</span>
        AI/ML Expertise
      </h4>
      <div class="skills-grid">
        <div class="skill-card">
          <span class="skill-icon"><Bot size={24} /></span>
          <div class="skill-content">
            <span class="skill-name">Agent Orchestration</span>
            <span class="skill-desc">Multi-agent systems, tool use, memory</span>
          </div>
        </div>
        <div class="skill-card">
          <span class="skill-icon"><BarChart3 size={24} /></span>
          <div class="skill-content">
            <span class="skill-name">Eval Systems</span>
            <span class="skill-desc">LLM-as-judge, rubric design, quality metrics</span>
          </div>
        </div>
        <div class="skill-card">
          <span class="skill-icon"><Search size={24} /></span>
          <div class="skill-content">
            <span class="skill-name">Observability</span>
            <span class="skill-desc">Tracing, logging, cost tracking</span>
          </div>
        </div>
        <div class="skill-card">
          <span class="skill-icon"><BookOpen size={24} /></span>
          <div class="skill-content">
            <span class="skill-name">RAG Systems</span>
            <span class="skill-desc">Retrieval optimization, chunking strategies</span>
          </div>
        </div>
        <div class="skill-card">
          <span class="skill-icon"><Database size={24} /></span>
          <div class="skill-content">
            <span class="skill-name">Vector Databases</span>
            <span class="skill-desc">Embeddings, similarity search, indexing</span>
          </div>
        </div>
        <div class="skill-card">
          <span class="skill-icon"><Zap size={24} /></span>
          <div class="skill-content">
            <span class="skill-name">LLM Pipelines</span>
            <span class="skill-desc">Multi-stage generation, validation loops</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Company card - neural node style -->
    <div class="company-node" id="ai-company">
      <div class="node-pulse"></div>
      <div class="node-content">
        <div class="company-avatar">
          <span class="avatar-glyph">AE</span>
          <div class="avatar-ring"></div>
        </div>

        <div class="company-info">
          <h4 class="company-name">AE Studio</h4>
          <p class="company-role">Senior AI Technical Product Manager</p>
          <p class="company-desc">
            160-person bootstrapped AI development agency. Building custom AI solutions
            for Fortune 10 executives. Mission: increase human agency.
          </p>

          <div class="client-nodes">
            <span class="client-node">Salesforce</span>
            <span class="client-node">Walmart</span>
            <span class="client-node">EVgo</span>
            <span class="client-node">Pacific Life</span>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<style>
  .ai-era {
    position: relative;
    min-height: 100vh;
    padding: 6rem 2rem 4rem;
    background: #020203;
    overflow: hidden;
  }

  /* Particle canvas - full section background */
  .particle-container {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .gradient-mesh {
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse 60% 50% at 20% 30%, rgba(168, 85, 247, 0.12), transparent),
      radial-gradient(ellipse 50% 60% at 80% 70%, rgba(34, 211, 238, 0.08), transparent),
      radial-gradient(ellipse 80% 40% at 50% 50%, rgba(168, 85, 247, 0.05), transparent);
    pointer-events: none;
    z-index: 1;
  }

  /* Neural node navigation */
  .node-nav-wrapper {
    position: fixed;
    right: 40px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 100;
    opacity: 0;
    transition: opacity 0.5s ease;
    pointer-events: none;
  }

  .ai-era:hover .node-nav-wrapper,
  .node-nav-wrapper:focus-within {
    opacity: 1;
    pointer-events: auto;
  }

  /* Content layer */
  .ai-content {
    position: relative;
    z-index: 2;
    max-width: 1100px;
    margin: 0 auto;
  }

  /* Floating badge */
  .floating-badge {
    display: inline-flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.5rem;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(168, 85, 247, 0.3);
    border-radius: 60px;
    backdrop-filter: blur(10px);
    margin-bottom: 3rem;
    animation: float 6s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  .badge-glyph {
    font-size: 1.5rem;
    color: #a855f7;
    animation: glyph-pulse 2s ease-in-out infinite;
  }

  @keyframes glyph-pulse {
    0%, 100% { opacity: 0.7; text-shadow: 0 0 10px rgba(168, 85, 247, 0.5); }
    50% { opacity: 1; text-shadow: 0 0 20px rgba(168, 85, 247, 0.8); }
  }

  .badge-text {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .badge-year {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: #22d3ee;
    letter-spacing: 0.1em;
  }

  .badge-title {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    color: #f0f0f0;
  }

  /* Heading */
  .heading-wrapper {
    margin-bottom: 2rem;
  }

  .ai-heading {
    font-size: clamp(3.5rem, 12vw, 7rem);
    line-height: 0.9;
    margin: 0;
    letter-spacing: -0.03em;
    display: block;
  }

  .ai-heading--accent {
    background: linear-gradient(135deg, #a855f7 0%, #22d3ee 50%, #a855f7 100%);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradient-shift 8s linear infinite;
  }

  @keyframes gradient-shift {
    0% { background-position: 0% center; }
    100% { background-position: 200% center; }
  }

  /* Intro */
  .ai-intro {
    font-family: 'Inter', sans-serif;
    font-size: 1.25rem;
    line-height: 1.7;
    color: rgba(240, 240, 240, 0.6);
    max-width: 600px;
    margin-bottom: 5rem;
  }

  .typing-cursor {
    animation: blink 0.7s step-end infinite;
    color: #a855f7;
  }

  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  /* Project card */
  .project-card {
    position: relative;
    background: rgba(0, 0, 0, 0.7);
    border-radius: 20px;
    padding: 2.5rem;
    margin-bottom: 6rem;
    overflow: hidden;
  }

  .card-border {
    position: absolute;
    inset: 0;
    border: 1px solid transparent;
    border-radius: 20px;
    background: linear-gradient(135deg, rgba(168, 85, 247, 0.3), rgba(34, 211, 238, 0.1)) border-box;
    -webkit-mask:
      linear-gradient(#fff 0 0) padding-box,
      linear-gradient(#fff 0 0);
    mask:
      linear-gradient(#fff 0 0) padding-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    pointer-events: none;
  }

  .card-glow {
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(
      ellipse at center,
      rgba(168, 85, 247, 0.1) 0%,
      transparent 70%
    );
    animation: glow-rotate 20s linear infinite;
    pointer-events: none;
  }

  @keyframes glow-rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .project-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1.5rem;
    position: relative;
    z-index: 1;
  }

  .project-badge-group {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .project-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: #a855f7;
    background: rgba(168, 85, 247, 0.15);
    padding: 0.35rem 0.75rem;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    border: 1px solid rgba(168, 85, 247, 0.3);
  }

  .project-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: #4ade80;
  }

  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #4ade80;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.4); }
    50% { opacity: 0.8; box-shadow: 0 0 0 6px rgba(74, 222, 128, 0); }
  }

  .project-company {
    font-family: 'Inter', sans-serif;
    font-size: 0.8rem;
    color: rgba(240, 240, 240, 0.4);
  }

  .project-title {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 2.5rem;
    font-weight: 600;
    color: #f0f0f0;
    margin: 0 0 1rem 0;
    position: relative;
    z-index: 1;
  }

  .project-desc {
    font-size: 1rem;
    color: rgba(240, 240, 240, 0.6);
    line-height: 1.7;
    margin: 0 0 2rem 0;
    max-width: 600px;
    position: relative;
    z-index: 1;
  }

  /* Compact Metrics Bar */
  .metrics-bar {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-bottom: 4rem;
    padding: 1.5rem;
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(168, 85, 247, 0.2);
    border-radius: 16px;
  }

  .metric-item {
    text-align: center;
    padding: 1rem;
  }

  .metric-value {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 2rem;
    font-weight: 600;
    background: linear-gradient(135deg, #a855f7, #22d3ee);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    display: block;
  }

  .metric-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: rgba(240, 240, 240, 0.5);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-top: 0.5rem;
    display: block;
  }

  /* AI Skills Section */
  .skills-section {
    margin-bottom: 4rem;
  }

  .skills-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
  }

  .skill-card {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.25rem;
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(168, 85, 247, 0.2);
    border-radius: 12px;
    transition: all 0.3s ease;
  }

  .skill-card:hover {
    border-color: rgba(168, 85, 247, 0.4);
    transform: translateY(-3px);
  }

  .skill-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    color: #a855f7;
  }

  .skill-icon :global(svg) {
    stroke-width: 1.5;
  }

  .skill-content {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .skill-name {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 0.95rem;
    font-weight: 600;
    color: #f0f0f0;
  }

  .skill-desc {
    font-family: 'Inter', sans-serif;
    font-size: 0.75rem;
    color: rgba(240, 240, 240, 0.5);
    line-height: 1.4;
  }

  .section-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1.25rem;
    font-weight: 500;
    color: #22d3ee;
    margin: 0 0 2rem 0;
  }

  .title-glyph {
    font-size: 1.5rem;
    animation: glyph-pulse 2s ease-in-out infinite;
    animation-delay: 0.5s;
  }

  /* Company node */
  .company-node {
    position: relative;
    padding: 2.5rem;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(168, 85, 247, 0.2);
    border-radius: 20px;
    margin-bottom: 2rem;
    overflow: hidden;
  }

  .node-pulse {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #a855f7;
    animation: pulse 2s ease-in-out infinite;
  }

  .node-content {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
    position: relative;
    z-index: 1;
  }

  .company-avatar {
    position: relative;
    width: 80px;
    height: 80px;
    flex-shrink: 0;
  }

  .avatar-glyph {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #a855f7, #22d3ee);
    border-radius: 16px;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1.75rem;
    font-weight: 700;
    color: #030303;
  }

  .avatar-ring {
    position: absolute;
    inset: -6px;
    border: 2px dashed rgba(168, 85, 247, 0.3);
    border-radius: 20px;
    animation: ring-spin 20s linear infinite;
  }

  @keyframes ring-spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .company-name {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1.5rem;
    font-weight: 600;
    color: #f0f0f0;
    margin: 0;
  }

  .company-role {
    font-family: 'Inter', sans-serif;
    font-size: 0.9rem;
    color: #a855f7;
    margin: 0.25rem 0 1rem 0;
  }

  .company-desc {
    font-size: 0.95rem;
    color: rgba(240, 240, 240, 0.6);
    line-height: 1.7;
    margin: 0 0 1.5rem 0;
  }

  .client-nodes {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .client-node {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: rgba(240, 240, 240, 0.5);
    background: rgba(168, 85, 247, 0.1);
    padding: 0.35rem 0.75rem;
    border-radius: 20px;
    border: 1px solid rgba(168, 85, 247, 0.2);
    transition: all 0.2s ease;
  }

  .client-node:hover {
    color: #a855f7;
    border-color: rgba(168, 85, 247, 0.4);
  }

  /* Mobile responsive */
  @media (max-width: 1024px) {
    .node-nav-wrapper {
      display: none;
    }

    .metrics-bar {
      grid-template-columns: repeat(2, 1fr);
    }

    .skills-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .ai-era {
      padding: 4rem 1rem 4rem;
      min-height: auto;
    }

    .ai-heading {
      font-size: clamp(2.5rem, 15vw, 4rem);
    }

    .metrics-bar {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
      padding: 1rem;
    }

    .metric-value {
      font-size: 1.5rem;
    }

    .skills-grid {
      grid-template-columns: 1fr;
    }

    .node-content {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .client-nodes {
      justify-content: center;
    }

    .project-card {
      padding: 1.5rem;
    }

    .project-header {
      flex-direction: column;
      gap: 0.75rem;
    }
  }
</style>

<script>
  // Dynamically load Three.js particle canvas
  const mount = document.getElementById('particle-mount');

  if (mount && window.matchMedia('(min-width: 768px)').matches) {
    import('../ai/ParticleCanvas.tsx').then(({ default: ParticleCanvas }) => {
      import('react-dom/client').then(({ createRoot }) => {
        import('react').then((React) => {
          const root = createRoot(mount);
          root.render(React.createElement(ParticleCanvas, { interactive: true }));
        });
      });
    });
  }

  // Intersection observer for scroll-reveal animations
  const revealElements = document.querySelectorAll('.skill-card, .company-node');

  const revealObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('revealed');
        }
      });
    },
    { threshold: 0.2 }
  );

  revealElements.forEach((el) => revealObserver.observe(el));
</script>
